<html>
<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script  src="https://www.calgary.ca/Scripts/coc/parts/coc.parts.js"></script>	
<script>
function generatesiteid(){ //Path to siteIds
window.alert("2: Generate Function");

 var resultsiteid = "";
	 jQuery.ajax({
	 url: 'https://services1.arcgis.com/AVP60cs0Q9PEA8rH/ArcGIS/rest/services/TrafficCameras_Public/FeatureServer/0/query?where=1%3D1&outFields=*&returnGeometry=true&outSR=4326&f=pjson',
	 type: "GET",
	contentType: "text/plain",
          dataType: "text",
	 success: function( data )
	{
window.alert("3: Inside success");

		var text = data ;
		var obj = JSON.parse(text);
	 var dataSet = transformData(obj);
	rendertrafficaccordion( dataSet);
	
		}  ,
		  async: false
});
//return resultsiteid;
		
}
	
	 var rendertrafficaccordion = function (dataSet) {
		 window.alert("5: Inside rendertrafficaccordion");
		 window.alert("inside rendertrafficaccordion ");
     
		 $("div#writeobject").html("<h2>Reading from rendertrafficaccordion: <h2><br>"); 
		 $("div#writeobject").text(dataSet);    
    };
	
	
 	
   var transformData = function (cityParkingLots) {
	   window.alert("4: Inside transformData");

        var dataSet = [];
        var i;
        var globalID;
        var ID;
        var ListType;
        var Description;
        var Quadrant;
        var Title;
        var URL;
        var IsPublic;
        var geometry;
        var record;
        for (i = 0; i < cityParkingLots.features.length; i++) {
            globalID = cityParkingLots.features[i].attributes.GLOBALID || "";
            ID = cityParkingLots.features[i].attributes.OBJECTID || "";
            ListType = cityParkingLots.features[i].attributes.ListType || "";
            Description = cityParkingLots.features[i].attributes.Description || "";
            Quadrant = cityParkingLots.features[i].attributes.Quadrant || "";
            Title = cityParkingLots.features[i].attributes.Title || "";
            URL = cityParkingLots.features[i].attributes.URL || "";
            IsPublic = cityParkingLots.features[i].attributes.IsPublic || "";
  
            geometry = cityParkingLots.features[i].geometry;
            record =
            {
                fields:
                [
		            {
		                name: "globalID",
		                label: "globalID",
		                value: globalID,
		                visible: false
		            },
		            {
		                name: "ID",
		                label: "ID",
		                value: ID,
		                visible: false
		            },
		            {
		                name: "ListType",
		                label: "ListType",
		                value: ListType,
		                visible: true
		            },
		            {
		                name: "Description",
		                label: "Description",
		                value: Description,
		                visible: true
		            },
		            {
		                name: "Quadrant",
		                label: "Quadrant",
		                value: Quadrant,
		                visible: true
		            },
		            {
		                name: "Title",
		                label: "Title",
		                value: Title,
		                visible: true
		            },
		            {
		                name: "URL",
		                label: "URL",
		                value: URL,
		                visible: true
		            },
		            {
		                name: "IsPublic",
		                label: "IsPublic",
		                value: IsPublic,
		                visible: true
		            }
                ],
                geometry: geometry
            };
            dataSet.push(record);
        }
        return dataSet;
    };
	
	
</script> 
	
</head>
<body>
<script>
$( document ).ready(function() {
	window.alert("1: inside doc ready");
generatesiteid();
});
	</script>
	
	
<H2>Get Cameras object</H2>


	
	<div id="writeobject"></div>
	</body>
</html>

