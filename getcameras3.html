<html>
<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script  src="https://www.calgary.ca/Scripts/coc/parts/coc.parts.js"></script>	
<script>
function generatesiteid(){ //Path to siteIds
//window.alert("2: Generate Function");

 var resultsiteid = "";
	 jQuery.ajax({
	 url: 'https://services1.arcgis.com/AVP60cs0Q9PEA8rH/ArcGIS/rest/services/TrafficCameras_Public/FeatureServer/0/query?where=1%3D1&outFields=*&returnGeometry=true&outSR=4326&f=pjson',
	 type: "GET",
	contentType: "text/plain",
          dataType: "text",
	 success: function( data )
	{
//window.alert("3: Inside success");

		var text = data ;
		var obj = JSON.parse(text);
	       var dataSet = transformData(obj.features);
	       rendertrafficaccordion( dataSet);
	
		}  ,
		  async: false
});
//return resultsiteid;
		
}
	
	 var rendertrafficaccordion = function (dataSet) {
		var j= "";
		 var i="";
		 var AccordionBody ="";
		 var AccordionHeader = "";
		 var AccordionHeaderObject ="";
		 var count = 0;
		 var currentsearchterm = "";
		 var headercount = 0;
		 var internaldiv="";
		var imgurl = "";
		var urlRegEx = /((([A-Za-z]{3,9}:(?:\/\/)?)(?:[\-;:&=\+\$,\w]+@)?[A-Za-z0-9\.\-]+|(?:www\.|[\-;:&=\+\$,\w]+@)[A-Za-z0-9\.\-]+)((?:\/[\+~%\/\.\w\-]*)?\??(?:[\-\+=&;%@\.\w]*)#?(?:[\.\!\/\\\w]*))?)/g;
var CameraPath;
		 //window.alert("5: Inside rendertrafficaccordion");
		 //window.alert("inside rendertrafficaccordion ");
     	   // $("div#writeobject").text(dataSet);     
		 //AccordionHeader = ",";
		
		 AccordionHeaderObject = { "AccordionHeader":[ "16 Avenue", "Bow Trail",
							      "Crowchild Trail","Deerfoot Trail",
							      "Glenmore Trail", "Macleod Trail",
							      "Memorial Drive","Stoney Trail"]};

for (j = 0; j < AccordionHeaderObject.AccordionHeader.length; j++) {
	
  currentsearchterm = AccordionHeaderObject.AccordionHeader[j];
	
	/*<h3 class="title-bar">{{ Accordion title }}</h3>
	<!-- The accordion content can be anything. -->
		{{ Accordion content }}

	<!-- Repeat as necessary -->
	<h3 class="title-bar">{{ Accordion title }}</h3>
		{{ Accordion content }}*/
 $("div#writeobject").append("<h3 class='title-bar'> <a><b>" + j + " : " + currentsearchterm + "</b></a></h3>" );
var colcount = 0;
for (i = 0; i < dataSet.length; i++) {
AccordionBody = dataSet[i].Title;

	imgurl = dataSet[i].URL;
CameraPath = imgurl.match(urlRegEx);

 	

	if(AccordionBody.indexOf(currentsearchterm) != -1){
	colcount = colcount + 1;
		if (colcount == 1) {internaldiv = "<div class='row'>";}
// $("div#writeobject").append("<p>" + count + ":"+  AccordionBody  +"</p><br>");
//$("div#writeobject").append("<div class='row'>");
internaldiv += "<div class='col-sm-6'><span><img src='" + CameraPath + "' alt= 'TRAFFIC CAMERA AT "+ AccordionBody  +"' ></span><br><span class='caption'> <p style='text-align:center;font-weight: bold; '>" +   AccordionBody + "</p></span> </div>";
	  if (colcount%2==0) {  internaldiv += "</div><div class='row'>";  }
		

			 
}
	
	
}
	//tr:nth-child(2)
	
	$("div#writeobject").append(internaldiv);


}
		 
		 
		 
		 /*
		 
		 var myObj, i, x = "";
myObj = {
  "MainHeaders":[ "Ford", "BMW", "Fiat" ]
};

for (i = 0; i < myObj.MainHeaders.length; i++) {
  x += myObj.MainHeaders[i] + "<br>";
}

*/
		 /*
		 myObj = {"name":"John", "age":30, "car":null};
for (x in myObj) {
  document.getElementById("demo").innerHTML += myObj[x] + "<br>";
}


*/
		// $("div#writeobject").append("<h2>" + AccordionHeader + "</h2><br>" );
// for (i = 0; i < dataSet.length; i++) {
	 //AccordionBody = dataSet[i].Title;
	 
	// if(AccordionBody.indexOf(AccordionHeader) != -1){
		// count = count+1;
		 
    // $("div#writeobject").append("<p>" + count + ":"+  AccordionBody  +"</p><br>"); 
//}
	 
	 //$("div#writeobject").append("<h2>" + accodrionresults + "</h2><br>");     

// }
		 //$("div#writeobject").text(dataSet);    
    };
	
	
 	
   var transformData = function (cityParkingLots) {
	  // window.alert("4: Inside transformData");
	   // $("div#writeobject").text(Object.keys(cityParkingLots));     


        var dataSet = [];
        var i;
        var globalID;
        var ID;
        var ListType;
        var Description;
        var Quadrant;
        var Title;
        var URL;
        var IsPublic;
        var geometry;
        var record;
        for (i = 0; i < cityParkingLots.length; i++) { //[""0""].attributes.Description
            globalID = cityParkingLots[i].attributes.GLOBALID || "";
            ID = cityParkingLots[i].attributes.OBJECTID || "";
            ListType = cityParkingLots[i].attributes.ListType || "";
            Description = cityParkingLots[i].attributes.Description || "";
            Quadrant = cityParkingLots[i].attributes.Quadrant || "";
            Title = cityParkingLots[i].attributes.Title || "";
            URL = cityParkingLots[i].attributes.URL || "";
            IsPublic = cityParkingLots[i].attributes.IsPublic || "";
  
            geometry = cityParkingLots[i].attributes.geometry;
            record = 
            {
                /*fields:
                [
		            {
		                name: "globalID",
		                label: "globalID",
		                value: globalID,
		                visible: false
		            },
		            {
		                name: "ID",
		                label: "ID",
		                value: ID,
		                visible: false
		            },
		            {
		                name: "ListType",
		                label: "ListType",
		                value: ListType,
		                visible: true
		            },
		            {
		                name: "Description",
		                label: "Description",
		                value: Description,
		                visible: true
		            },
		            {
		                name: "Quadrant",
		                label: "Quadrant",
		                value: Quadrant,
		                visible: true
		            },
		            {
		                name: "Title",
		                label: "Title",
		                value: Title,
		                visible: true
		            },
		            {
		                name: "URL",
		                label: "URL",
		                value: URL,
		                visible: true
		            },
		            {
		                name: "IsPublic",
		                label: "IsPublic",
		                value: IsPublic,
		                visible: true
		            }
                ]*/
		   "Description": Description,"Quadrant": Quadrant,"Title": Title, "URL":URL, "IsPublic": IsPublic, };
		  //  ,
                //geometry: geometry
          //  };
            dataSet.push(record);
        }
        return dataSet;
    };
	
	
</script> 
	
</head>
<body>
<script>
$( document ).ready(function() {
	//window.alert("1: inside doc ready");
generatesiteid();
});
	</script>
	
	
<H2>Get Cameras object</H2>


	
	<div id="writeobject1"></div>
	
	<div class="cui accordion {{ acc-wrap }} {{ default-expanded }}" id="writeobject" >
	<!-- The accordion title can be any heading element as long as it has the class `title-bar` -->
	
</div>
	
	
	</body>
</html>

