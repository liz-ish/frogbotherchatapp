<html>
<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script  src="https://www.calgary.ca/Scripts/coc/parts/coc.parts.js"></script>	
<script>
function generatesiteid(){ //Path to siteIds
//window.alert("2: Generate Function");

 var resultsiteid = "";
	 jQuery.ajax({
	 url: 'https://services1.arcgis.com/AVP60cs0Q9PEA8rH/ArcGIS/rest/services/TrafficCameras_Public/FeatureServer/0/query?where=1%3D1&outFields=*&returnGeometry=true&outSR=4326&f=pjson',
	 type: "GET",
	contentType: "text/plain",
          dataType: "text",
	 success: function( data )
	{
//window.alert("3: Inside success");

		var text = data ;
		var obj = JSON.parse(text);
	       var dataSet = transformData(obj.features);
	       rendertrafficaccordion( dataSet);
	
		}  ,
		  async: false
});
//return resultsiteid;
		
}
	
	 var rendertrafficaccordion = function (dataSet) {
		 var AccordionBody ="";
		 var AccordionHeader = "";
		 //window.alert("5: Inside rendertrafficaccordion");
		 //window.alert("inside rendertrafficaccordion ");
     	   // $("div#writeobject").text(dataSet);     
		 AccordionHeader = "16 Avenue";
 for (i = 0; i < dataSet.length; i++) {
	 AccordionBody = dataSet[i].Title;
	 
	 if(AccordionBody.indexOf(AccordionHeader) != -1){
		 
     $("div#writeobject").append("<h1>" + AccordionHeader + "</h1><br> + <h2>" +  AccordionBody  +"</h2>"); 
}
	 
	 //$("div#writeobject").append("<h2>" + accodrionresults + "</h2><br>");     

 }
		 //$("div#writeobject").text(dataSet);    
    };
	
	
 	
   var transformData = function (cityParkingLots) {
	  // window.alert("4: Inside transformData");
	   // $("div#writeobject").text(Object.keys(cityParkingLots));     


        var dataSet = [];
        var i;
        var globalID;
        var ID;
        var ListType;
        var Description;
        var Quadrant;
        var Title;
        var URL;
        var IsPublic;
        var geometry;
        var record;
        for (i = 0; i < cityParkingLots.length; i++) { //[""0""].attributes.Description
            globalID = cityParkingLots[i].attributes.GLOBALID || "";
            ID = cityParkingLots[i].attributes.OBJECTID || "";
            ListType = cityParkingLots[i].attributes.ListType || "";
            Description = cityParkingLots[i].attributes.Description || "";
            Quadrant = cityParkingLots[i].attributes.Quadrant || "";
            Title = cityParkingLots[i].attributes.Title || "";
            URL = cityParkingLots[i].attributes.URL || "";
            IsPublic = cityParkingLots[i].attributes.IsPublic || "";
  
            geometry = cityParkingLots[i].attributes.geometry;
            record = 
            {
                /*fields:
                [
		            {
		                name: "globalID",
		                label: "globalID",
		                value: globalID,
		                visible: false
		            },
		            {
		                name: "ID",
		                label: "ID",
		                value: ID,
		                visible: false
		            },
		            {
		                name: "ListType",
		                label: "ListType",
		                value: ListType,
		                visible: true
		            },
		            {
		                name: "Description",
		                label: "Description",
		                value: Description,
		                visible: true
		            },
		            {
		                name: "Quadrant",
		                label: "Quadrant",
		                value: Quadrant,
		                visible: true
		            },
		            {
		                name: "Title",
		                label: "Title",
		                value: Title,
		                visible: true
		            },
		            {
		                name: "URL",
		                label: "URL",
		                value: URL,
		                visible: true
		            },
		            {
		                name: "IsPublic",
		                label: "IsPublic",
		                value: IsPublic,
		                visible: true
		            }
                ]*/
		   "Description": Description,"Quadrant": Quadrant,"Title": Title, "URL":URL, "IsPublic": IsPublic, };
		  //  ,
                //geometry: geometry
          //  };
            dataSet.push(record);
        }
        return dataSet;
    };
	
	
</script> 
	
</head>
<body>
<script>
$( document ).ready(function() {
	//window.alert("1: inside doc ready");
generatesiteid();
});
	</script>
	
	
<H2>Get Cameras object</H2>


	
	<div id="writeobject"></div>
	</body>
</html>

